"use strict";(self.webpackChunkchoice_champ=self.webpackChunkchoice_champ||[]).push([[386],{5541:function(e,t,n){n(2791);t.Z=n.p+"static/media/back.130646437979786be8370a1fdf68655a.svg"},8386:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var r=n(3433),i=n(9439),o=n(2791),c=n(7689),s=n(3999),a=n(1425),u=n.n(a),l=n(5541),d=n(584),m=n(5382),f=(n(8890),n(3108)),h=n(184),p=function(e){var t=e.socket,n=(0,o.useContext)(f.V),a=(0,c.s0)(),p=(0,c.UO)(),v=p.code,g=p.userType,y=(0,o.useState)([]),x=(0,i.Z)(y,2),j=x[0],N=x[1],b=(0,o.useState)("movie"),C=(0,i.Z)(b,2),Z=C[0],w=C[1],k=(0,o.useState)(1),T=(0,i.Z)(k,2),E=T[0],S=T[1],F=(0,o.useState)(!1),I=(0,i.Z)(F,2),R=I[0],B=I[1],D=(0,o.useState)(!1),H=(0,i.Z)(D,2),M=H[0],L=H[1],O=(0,o.useState)(0),V=(0,i.Z)(O,2),_=V[0],z=V[1],U=(0,o.useState)(0),W=(0,i.Z)(U,2),Y=W[0],A=W[1],G=(0,o.useState)([]),P=(0,i.Z)(G,2),q=P[0],J=P[1],K=(0,o.useState)(!1),Q=(0,i.Z)(K,2),X=Q[0],$=Q[1],ee=(0,o.useState)(!1),te=(0,i.Z)(ee,2),ne=te[0],re=te[1],ie=(0,o.useRef)(j),oe=(0,o.useRef)(E),ce=(0,o.useRef)(_),se=(0,o.useRef)(Y);(0,o.useEffect)((function(){n.showFooterHandler(!1),fetch("https://choice-champ-backend.glitch.me/party/".concat(v),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var n=e.party.items.map((function(e){return{id:e._id,itemId:e.itemId,title:e.title,poster:e.poster,watched:e.watched,votes:0,voted:!1}}));n=n.filter((function(e,t,n){return t===n.findIndex((function(t){return t.itemId===e.itemId}))})),e.party.includeWatched||(n=n.filter((function(e){return!e.watched}))),n=n.sort((function(){return Math.random()-.5})),w(e.party.mediaType),B(e.party.secretMode),A(e.party.memberCount),se.current=e.party.memberCount,N(n),ie.current=n,t.emit("join-room",v)}))}),[]),(0,o.useEffect)((function(){return t.on("vote-increment",(function(e){ie.current.find((function(t){return t.id==e})).votes+=1,N((0,r.Z)(ie.current))})),t.on("vote-decrement",(function(e){ie.current.find((function(t){return t.id==e})).votes-=1,N((0,r.Z)(ie.current))})),t.on("votes-needed",(function(e){S(e),oe.current=e})),t.on("vote-selected",(function(e){var t=ie.current.filter((function(t){return t.votes>=e}));if(t.forEach((function(e){e.votes=0,e.voted=!1})),1===t.length){var n=ie.current.filter((function(t){return t.votes<e}));J(n)}N(t),ie.current=t})),t.on("random-selected",(function(e){t.emit("leave-room",v),M&&L(!1),re(!0),setTimeout((function(){$(!0),setTimeout((function(){var t=ie.current.find((function(t){return t.id===e})),n=ie.current.filter((function(t){return t.id!==e}));J(n),N([t]),ie.current=[t]}),2e3)}),1e3)})),t.on("user-ready",(function(){ce.current+=1,z(ce.current),ce.current==se.current&&setTimeout((function(){$(!0),setTimeout((function(){var e=ie.current.filter((function(e){return e.votes>=oe.current}));if(0!==e.length){if(1===e.length){var t=ie.current.filter((function(e){return e.votes<oe.current}));J(t)}else e.forEach((function(e){e.votes=0,e.voted=!1})),z(0),ce.current=0;N(e),ie.current=e,L(!1),$(!1)}else L(!1)}),2e3)}),1e3)})),t.on("user-not-ready",(function(){ce.current-=1,z(ce.current)})),t.on("party-member-left",(function(){A(se.current-1),se.current-=1})),t.on("party-deleted",(function(){t.emit("leave-room",v),a("/party")})),function(){t.off("vote-increment"),t.off("vote-decrement"),t.off("votes-needed"),t.off("vote-selected"),t.off("random-selected"),t.off("party-deleted"),t.off("clear-votes"),t.off("user-ready"),t.off("user-not-ready"),t.off("party-member-left")}}),[]);var ae=function(e){var n=j.find((function(t){return t.id===e}));n.voted?(n.voted=!1,n.votes-=1,N((0,r.Z)(j)),ie.current=(0,r.Z)(j),t.emit("vote-remote-decrement",e,v)):(n.voted=!0,n.votes+=1,N((0,r.Z)(j)),ie.current=(0,r.Z)(j),t.emit("vote-remote-increment",e,v))};return(0,h.jsxs)("div",{className:"content",children:[1===j.length&&(0,h.jsx)(u(),{height:window.outerHeight+window.innerHeight}),(0,h.jsx)("img",{src:l.Z,alt:"Back symbol",onClick:function(){"owner"===g&&j.length>1?fetch("https://choice-champ-backend.glitch.me/party/".concat(v),{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(e){t.emit("leave-room",v),t.emit("party-remote-deleted",v),a("/party")})):(t.emit("user-leave-party",v),t.emit("leave-room",v),a("/party"))},className:"top-left"}),"owner"===g&&j.length>1?(0,h.jsxs)("div",{className:"votes-needed-section",children:[(0,h.jsx)("p",{className:"votes-needed-title",children:"Votes Needed"}),(0,h.jsx)("input",{type:"number",className:"votes-needed-input",value:E,min:1,onChange:function(e){S(e.target.value),oe.current=e.target.value,isNaN(e.target.value)||""===e.target.value||t.emit("votes-needed-remote",e.target.value,v)}})]}):(0,h.jsx)("div",{className:"guest-banner"}),"owner"===g&&j.length>1&&(0,h.jsx)("img",{src:d,className:"edit",alt:"Dice",onClick:function(){if(1!==j.length){re(!0);var e=Math.floor(Math.random()*j.length),n=j[e];n.votes=0,n.voted=!1;var r=j.filter((function(e){return e.id!==n.id}));setTimeout((function(){$(!0),setTimeout((function(){J(r),N([n]),ie.current=[n],fetch("https://choice-champ-backend.glitch.me/party/".concat(v),{method:"DELETE",headers:{"Content-Type":"application/json"}})}),2e3)}),1e3),t.emit("random-remote-selected",n.id,v)}}}),(0,h.jsx)("div",{className:"game"===Z?"collection-content-game":"collection-content-other",children:1===j.length?(0,h.jsxs)("div",{className:"winner",children:[(0,h.jsx)("p",{className:"winner-banner",children:"CHOICE CHAMPION!"}),(0,h.jsx)("img",{className:"game"===Z?"winner-img-game":"winner-img",src:j[0].poster}),(0,h.jsx)("p",{className:"winner-title",children:j[0].title}),(0,h.jsx)("p",{className:"runner-up-title",children:"Runner Ups"}),q.length>0&&q.map((function(e){return(0,h.jsx)("p",{className:"runner-up",children:e.title},e.id)}))]}):(0,r.Z)(j).reverse().map((function(e){return(0,h.jsxs)("div",{className:"item-section",children:[(0,h.jsx)("img",{className:"item-img",src:e.poster,onClick:ae.bind(undefined,e.id),style:e.voted?{border:"5px solid #FCB016"}:null}),("game"===Z||"board"===Z)&&(0,h.jsx)("p",{style:e.voted?{borderLeft:"5px solid #FCB016",borderRight:"5px solid #FCB016",borderBottom:"5px solid #FCB016",borderRadius:"0px 0px 9px 9px"}:null,children:e.title}),e.votes>0&&!R&&(0,h.jsx)("div",{className:"item-votes",children:e.votes})]},e.id)}))}),j.length>1&&(M?(0,h.jsx)("div",{className:"ready-overlay",onClick:Y>1?function(){L(!1),ce.current-=1,z(ce.current),t.emit("user-not-ready-remote",v)}:null,style:X?{transform:"translateY(100vh)",transition:"transform 2s ease-in-out"}:null,children:1===Y?(0,h.jsxs)(o.Fragment,{children:[(0,h.jsx)("h1",{className:"ready-text",style:{marginBottom:"30px"},children:"Filtering Items"}),(0,h.jsx)(m.Z,{type:"beat",className:"ready-loading",size:20,speed:.5})]}):(0,h.jsxs)(o.Fragment,{children:[(0,h.jsx)("h1",{className:"ready-text",children:"Ready!"}),(0,h.jsx)("p",{className:"waiting-text",children:"Waiting on other party members..."}),(0,h.jsx)("p",{className:"waiting-text-cancel",children:"Click to return to voting"}),(0,h.jsx)(m.Z,{type:"sync",className:"ready-loading",size:20,speed:.5})]})}):ne?null:(0,h.jsx)(s.Z,{className:"finish-voting-btn",onClick:function(){L(!0),ce.current+=1,z(ce.current),ce.current==se.current&&setTimeout((function(){$(!0),setTimeout((function(){var e=j.filter((function(e){return e.votes>=oe.current}));if(0!==e.length){if(1===e.length){var t=j.filter((function(e){return e.votes<oe.current}));J(t),fetch("https://choice-champ-backend.glitch.me/party/".concat(v),{method:"DELETE",headers:{"Content-Type":"application/json"}})}else e.forEach((function(e){e.votes=0,e.voted=!1})),z(0),ce.current=0;N(e),ie.current=e,L(!1),$(!1)}else L(!1)}),2e3)}),1e3),t.emit("user-ready-remote",v)},children:"Finish Voting"})),ne&&(0,h.jsx)("div",{className:"ready-overlay",style:X?{transform:"translateY(100vh)",transition:"transform 2s ease-in-out"}:null,children:(0,h.jsx)("img",{src:d,className:"random-selected-dice",alt:"Dice"})})]})}},3999:function(e,t,n){n.d(t,{Z:function(){return i}});n(2791);var r=n(184),i=function(e){return(0,r.jsx)("button",{type:e.type,disabled:e.disabled,onClick:e.onClick,className:e.className,children:e.children})}},584:function(e,t,n){e.exports=n.p+"static/media/dices.682aa6ebb10e531380e1.png"}}]);
//# sourceMappingURL=386.655e2044.chunk.js.map