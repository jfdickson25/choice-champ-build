"use strict";(self.webpackChunkchoice_champ=self.webpackChunkchoice_champ||[]).push([[386],{5541:function(e,t,n){n(2791);t.Z=n.p+"static/media/back.130646437979786be8370a1fdf68655a.svg"},8386:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var r=n(1413),o=n(3433),i=n(9439),c=n(2791),s=n(7689),a=n(3999),u=n(1425),l=n.n(u),d=n(5541),m=n(584),f=n(5382),h=n(3108),p=n(9170),v=n(184),g=function(e){var t=e.socket,n=(0,c.useContext)(h.V),u=(0,s.s0)(),g=(0,s.UO)().code,y=(0,c.useState)([]),x=(0,i.Z)(y,2),j=x[0],b=x[1],w=(0,c.useState)("movie"),N=(0,i.Z)(w,2),Z=N[0],C=N[1],T=(0,c.useState)(1),k=(0,i.Z)(T,2),E=k[0],S=k[1],I=(0,c.useState)(!1),F=(0,i.Z)(I,2),R=F[0],B=F[1],D=(0,c.useState)(!1),H=(0,i.Z)(D,2),M=H[0],L=H[1],O=(0,c.useState)(0),V=(0,i.Z)(O,2),_=V[0],z=V[1],A=(0,c.useState)(0),U=(0,i.Z)(A,2),W=U[0],Y=U[1],G=(0,c.useState)([]),P=(0,i.Z)(G,2),q=P[0],J=P[1],K=(0,c.useState)("guest"),Q=(0,i.Z)(K,2),X=Q[0],$=Q[1],ee=(0,c.useState)(!1),te=(0,i.Z)(ee,2),ne=te[0],re=te[1],oe=(0,c.useState)(!1),ie=(0,i.Z)(oe,2),ce=ie[0],se=ie[1],ae=(0,c.useState)(!1),ue=(0,i.Z)(ae,2),le=ue[0],de=ue[1],me=(0,c.useRef)(j),fe=(0,c.useRef)(E),he=(0,c.useRef)(_),pe=(0,c.useRef)(W);(0,c.useEffect)((function(){n.showFooterHandler(!1),fetch("https://choice-champ-backend.glitch.me/party/".concat(g,"?userId=").concat(n.userId),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){e.owner&&$("owner");var n=e.party.items.map((function(e){return{id:e._id,itemId:e.itemId,title:e.title,poster:e.poster,watched:e.watched,votes:0,voted:!1}}));n=n.filter((function(e,t,n){return t===n.findIndex((function(t){return t.itemId===e.itemId}))})),e.party.includeWatched||(n=n.filter((function(e){return!e.watched}))),n=n.sort((function(){return Math.random()-.5})),C(e.party.mediaType),B(e.party.secretMode),Y(e.party.memberCount),pe.current=e.party.memberCount,b(n),me.current=n,t.emit("join-room",g)}))}),[]),(0,c.useEffect)((function(){return t.on("vote-increment",(function(e){me.current.find((function(t){return t.id==e})).votes+=1,b((0,o.Z)(me.current))})),t.on("vote-decrement",(function(e){me.current.find((function(t){return t.id==e})).votes-=1,b((0,o.Z)(me.current))})),t.on("votes-needed",(function(e){S(e),fe.current=e})),t.on("vote-selected",(function(e){var t=me.current.filter((function(t){return t.votes>=e}));if(t.forEach((function(e){e.votes=0,e.voted=!1})),1===t.length){var n=me.current.filter((function(t){return t.votes<e}));J(n)}b(t),me.current=t})),t.on("random-selected",(function(e){t.emit("leave-room",g),M&&L(!1),se(!0),setTimeout((function(){re(!0),setTimeout((function(){var t=me.current.find((function(t){return t.id===e}));window.scrollTo(0,0);var n=me.current.filter((function(t){return t.id!==e}));J(n),b([t]),me.current=[t]}),2e3)}),1e3)})),t.on("user-ready",(function(){he.current+=1,z(he.current),he.current==pe.current&&setTimeout((function(){re(!0),setTimeout((function(){var e=me.current.filter((function(e){return e.votes>=fe.current}));if(0!==e.length){if(1===e.length){window.scrollTo(0,0);var t=me.current.filter((function(e){return e.votes<fe.current}));J(t)}else e.forEach((function(e){e.votes=0,e.voted=!1})),window.scrollTo(0,0),z(0),he.current=0;b(e),me.current=e,L(!1),re(!1)}else L(!1)}),2e3)}),1e3)})),t.on("user-not-ready",(function(){he.current-=1,z(he.current)})),t.on("party-member-left",(function(){Y(pe.current-1),pe.current-=1})),t.on("party-deleted",(function(){t.emit("leave-room",g),u("/party")})),function(){t.off("vote-increment"),t.off("vote-decrement"),t.off("votes-needed"),t.off("vote-selected"),t.off("random-selected"),t.off("party-deleted"),t.off("clear-votes"),t.off("user-ready"),t.off("user-not-ready"),t.off("party-member-left")}}),[]);var ve=function(e){var n=j.find((function(t){return t.id===e}));n.voted?(n.voted=!1,n.votes-=1,b((0,o.Z)(j)),me.current=(0,o.Z)(j),t.emit("vote-remote-decrement",e,g)):(n.voted=!0,n.votes+=1,b((0,o.Z)(j)),me.current=(0,o.Z)(j),t.emit("vote-remote-increment",e,g))},ge=(0,p.TA)((function(){console.log("longpress is triggered")}),{onCancel:function(e){return console.log("longpress cancel")},threshold:1e3});return(0,v.jsxs)("div",{className:"content",children:[1===j.length&&(0,v.jsx)(l(),{height:window.outerHeight+window.innerHeight}),(0,v.jsx)("img",{src:d.Z,alt:"Back symbol",onClick:function(){"owner"===X&&j.length>1?fetch("https://choice-champ-backend.glitch.me/party/".concat(g),{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(e){de(!0),setTimeout((function(){de(!1),t.emit("leave-room",g),t.emit("party-remote-deleted",g),u("/party")}),1e3)})):(de(!0),setTimeout((function(){de(!1),t.emit("user-leave-party",g),t.emit("leave-room",g),u("/party")}),1e3))},className:"top-left clickable",style:le?{animation:"button-press .75s"}:null}),"owner"===X&&j.length>1?(0,v.jsxs)("div",{className:"votes-needed-section",children:[(0,v.jsx)("p",{className:"votes-needed-title",children:"Votes Needed"}),(0,v.jsx)("input",{type:"number",className:"votes-needed-input",value:E,min:1,onChange:function(e){S(e.target.value),fe.current=e.target.value,isNaN(e.target.value)||""===e.target.value||t.emit("votes-needed-remote",e.target.value,g)}})]}):(0,v.jsx)("div",{className:"guest-banner"}),"owner"===X&&j.length>1&&(0,v.jsx)("img",{src:m,className:"edit clickable",alt:"Dice",onClick:function(){if(1!==j.length){se(!0);var e=Math.floor(Math.random()*j.length),n=j[e];n.votes=0,n.voted=!1;var r=j.filter((function(e){return e.id!==n.id}));setTimeout((function(){re(!0),setTimeout((function(){J(r),b([n]),me.current=[n],window.scrollTo(0,0),fetch("https://choice-champ-backend.glitch.me/party/".concat(g),{method:"DELETE",headers:{"Content-Type":"application/json"}})}),2e3)}),1e3),t.emit("random-remote-selected",n.id,g)}}}),(0,v.jsx)("div",{className:"game"===Z?"collection-content-game":"collection-content-other",children:1===j.length?(0,v.jsxs)("div",{className:"winner",children:[(0,v.jsx)("p",{className:"winner-banner",children:"CHOICE CHAMPION!"}),(0,v.jsx)("img",{className:"game"===Z?"winner-img-game":"winner-img",src:j[0].poster}),(0,v.jsx)("p",{className:"winner-title",children:j[0].title}),(0,v.jsx)("p",{className:"runner-up-title",children:"Runner Ups"}),q.length>0&&q.map((function(e){return(0,v.jsx)("p",{className:"runner-up",children:e.title},e.id)}))]}):(0,o.Z)(j).reverse().map((function(e){return(0,v.jsxs)("div",(0,r.Z)((0,r.Z)({className:"item-section"},ge),{},{onClick:ve,children:[(0,v.jsx)("img",{id:e.id,className:"movie"===Z||"tv"===Z?"item-img":"game"===Z?"game-img":"board-img",src:e.poster,style:e.voted?{border:"5px solid #FCB016"}:null}),("game"===Z||"board"===Z)&&(0,v.jsx)("p",{style:e.voted?{borderLeft:"5px solid #FCB016",borderRight:"5px solid #FCB016",borderBottom:"5px solid #FCB016",borderRadius:"0px 0px 9px 9px"}:null,children:e.title}),e.votes>0&&!R&&(0,v.jsx)("div",{className:"item-votes",children:e.votes})]}),e.id)}))}),j.length>1&&(M?(0,v.jsx)("div",{className:"ready-overlay",onClick:W>1?function(){L(!1),he.current-=1,z(he.current),t.emit("user-not-ready-remote",g)}:null,style:ne?{transform:"translateY(100vh)",transition:"transform 2s ease-in-out"}:null,children:1===W?(0,v.jsxs)(c.Fragment,{children:[(0,v.jsx)("h1",{className:"ready-text",style:{marginBottom:"30px"},children:"Filtering Items"}),(0,v.jsx)(f.Z,{type:"beat",className:"ready-loading",size:20,speed:.5})]}):(0,v.jsxs)(c.Fragment,{children:[(0,v.jsx)("h1",{className:"ready-text",children:"Ready!"}),(0,v.jsx)("p",{className:"waiting-text",children:"Waiting on other party members..."}),(0,v.jsx)("p",{className:"waiting-text-cancel",children:"Click to return to voting"}),(0,v.jsx)(f.Z,{type:"sync",className:"ready-loading",size:20,speed:.5})]})}):ce?null:(0,v.jsx)(a.Z,{className:"finish-voting-btn",onClick:function(){L(!0),he.current+=1,z(he.current),he.current==pe.current&&setTimeout((function(){re(!0),setTimeout((function(){var e=j.filter((function(e){return e.votes>=fe.current}));if(0!==e.length){if(1===e.length){var t=j.filter((function(e){return e.votes<fe.current}));J(t),window.scrollTo(0,0),fetch("https://choice-champ-backend.glitch.me/party/".concat(g),{method:"DELETE",headers:{"Content-Type":"application/json"}})}else e.forEach((function(e){e.votes=0,e.voted=!1})),window.scrollTo(0,0),z(0),he.current=0;b(e),me.current=e,L(!1),re(!1)}else L(!1)}),2e3)}),1e3),t.emit("user-ready-remote",g)},children:"Finish Voting"})),ce&&(0,v.jsx)("div",{className:"ready-overlay",style:ne?{transform:"translateY(100vh)",transition:"transform 2s ease-in-out"}:null,children:(0,v.jsx)("img",{src:m,className:"random-selected-dice",alt:"Dice"})})]})}},3999:function(e,t,n){n.d(t,{Z:function(){return o}});n(2791);var r=n(184),o=function(e){return(0,r.jsx)("button",{type:e.type,disabled:e.disabled,onClick:e.onClick,className:e.className,children:e.children})}},584:function(e,t,n){e.exports=n.p+"static/media/dices.682aa6ebb10e531380e1.png"}}]);
//# sourceMappingURL=386.99577e4b.chunk.js.map